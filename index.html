<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thinking in Odds</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f7fa;
      color: #333;
      margin: 0;
      padding: 16px;
      line-height: 1.6;
    }
    h1 { text-align: center; color: #2c3e50; margin-bottom: 8px; }
    p.subtitle { text-align: center; color: #7f8c8d; margin-top: 0; }

    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
    }

    button {
      padding: 12px;
      margin: 8px 0;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }
    .add-btn { background: #3498db; color: white; width: 100%; }
    .add-btn:active { background: #2980b9; }
    .calc-btn { background: #27ae60; color: white; width: 100%; }
    .calc-btn:active { background: #219a52; }
    .new-decision-btn { background: #9b59b6; color: white; width: 100%; margin-top: 0; }

    input[type="range"] {
      width: 100%;
      margin: 16px 0;
    }
    .slider-value {
      text-align: center;
      font-size: 32px;
      font-weight: bold;
      color: #3498db;
      margin: 10px 0;
    }

    .toggle-group {
      display: flex;
      margin: 12px 0;
    }
    .toggle-btn {
      flex: 1;
      padding: 12px;
      border: 2px solid #ddd;
      background: white;
      font-weight: bold;
    }
    .toggle-btn:first-child { border-radius: 8px 0 0 8px; }
    .toggle-btn:last-child { border-radius: 0 8px 8px 0; }
    .toggle-btn.active.for { border-color: #27ae60; background: #27ae60; color: white; }
    .toggle-btn.active.against { border-color: #e74c3c; background: #e74c3c; color: white; }

    /* Fixed Decisions List */
    .decision-item {
      padding: 16px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      border-radius: 8px;
      margin: 4px 0;
    }
    .decision-item:last-child { border-bottom: none; }
    .decision-item.active {
      background: #3498db;
      color: white;
    }
    .decision-info {
      flex-grow: 1;
    }
    .delete-decision-btn {
      background: #e74c3c;
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      min-width: 80px;
      margin-left: 12px;
    }
    .decision-item.active .delete-decision-btn {
      background: #c0392b;
    }

    /* Collapsible Factors */
    .collapsible-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      padding: 10px 0;
      font-size: 18px;
      font-weight: bold;
    }
    .arrow {
      font-size: 24px;
      transition: transform 0.3s;
    }
    .arrow.down { transform: rotate(90deg); }

    .factors-content {
      transition: max-height 0.4s ease;
      overflow: hidden;
    }
    .factors-content.collapsed {
      max-height: 0;
      padding: 0;
      margin: 0;
    }

    .factor {
      background: #ecf0f1;
      padding: 14px;
      border-radius: 8px;
      margin: 12px 0;
      position: relative;
    }
    .factor strong { display: block; font-size: 18px; }
    .factor .tag {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      color: white;
    }
    .tag.for { background: #27ae60; }
    .tag.against { background: #e74c3c; }

    .delete-btn {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      margin-top: 12px;
      width: 100%;
    }

    .odds {
      font-size: 40px;
      font-weight: bold;
      text-align: center;
      margin: 20px 0;
    }
    .odds.high { color: #27ae60; }
    .odds.medium { color: #f39c12; }
    .odds.low { color: #e74c3c; }

    .empty-message {
      color: #95a5a6;
      text-align: center;
      padding: 20px 0;
    }
  </style>
</head>
<body>
  <h1>Thinking in Odds</h1>
  <p class="subtitle">Portfolio of decisions with probabilities</p>

  <!-- Decisions Portfolio -->
  <div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 style="margin:0;">Your Decisions</h3>
      <button class="new-decision-btn" onclick="createNewDecision()">+ New Decision</button>
    </div>
    <div id="decisionsList">
      <p class="empty-message">No decisions yet. Create one!</p>
    </div>
  </div>

  <!-- Current Decision Editor -->
  <div id="editorSection" style="display:none;">
    <div class="card">
      <input type="text" id="decisionName" placeholder="Edit decision name" />

      <h3 style="margin-bottom:0;">Add Factor</h3>
      <input type="text" id="factorName" placeholder="Factor name" />

      <div class="toggle-group">
        <button class="toggle-btn active for" onclick="setDirection('for')">For</button>
        <button class="toggle-btn against" onclick="setDirection('against')">Against</button>
      </div>

      <label style="font-size:14px; color:#7f8c8d;">Strength: <span id="sliderValue">50</span>%</label>
      <input type="range" id="likelihood" min="0" max="100" value="50" oninput="updateSlider()" />

      <input type="number" id="weight" placeholder="Weight (optional, default 1.0)" min="0" step="0.1" />

      <button class="add-btn" onclick="addFactor()">Add Factor</button>
      <button class="calc-btn" onclick="calculateOdds()">Calculate Odds</button>
    </div>

    <!-- Factors List -->
    <div class="card">
      <div class="collapsible-header" onclick="toggleFactors()">
        <span>Factors (<span id="factorCount">0</span>)</span>
        <span class="arrow" id="arrow">▶</span>
      </div>
      <div class="factors-content" id="factorsContent">
        <div id="factorsList">
          <p class="empty-message">No factors yet. Add one above!</p>
        </div>
      </div>
    </div>

    <!-- Result -->
    <div class="card" id="resultCard" style="display:none; text-align:center;">
      <h2 id="decisionTitle">Decision</h2>
      <div class="odds" id="overallOdds">0%</div>
      <p style="color:#7f8c8d;">Weighted probability</p>
    </div>
  </div>

  <script>
    let decisions = [];
    let currentDecisionIndex = -1;
    let currentDirection = 'for';
    let factorsExpanded = true;

    function loadData() {
      const saved = localStorage.getItem('thinkingInOddsDecisions');
      if (saved) {
        decisions = JSON.parse(saved);
      }
      if (decisions.length === 0) {
        createNewDecision();
      }
      renderDecisionsList();
      if (decisions.length > 0) {
        selectDecision(0);
      }
    }

    function saveData() {
      localStorage.setItem('thinkingInOddsDecisions', JSON.stringify(decisions));
    }

    function createNewDecision() {
      const name = prompt("Enter a name for your new decision:") || `Decision ${decisions.length + 1}`;
      decisions.push({
        name: name,
        factors: []
      });
      saveData();
      renderDecisionsList();
      selectDecision(decisions.length - 1);
    }

    function deleteDecision(index) {
      if (confirm(`Delete "${decisions[index].name}"? This cannot be undone.`)) {
        decisions.splice(index, 1);
        saveData();
        renderDecisionsList();
        if (decisions.length === 0) {
          currentDecisionIndex = -1;
          document.getElementById('editorSection').style.display = 'none';
          createNewDecision();
        } else if (currentDecisionIndex >= decisions.length) {
          selectDecision(decisions.length - 1);
        } else {
          selectDecision(currentDecisionIndex);
        }
      }
    }

    function selectDecision(index) {
      currentDecisionIndex = index;
      renderDecisionsList();
      renderCurrentDecision();
      document.getElementById('editorSection').style.display = 'block';
    }

    function renderDecisionsList() {
      const list = document.getElementById('decisionsList');
      if (decisions.length === 0) {
        list.innerHTML = '<p class="empty-message">No decisions yet. Create one!</p>';
        return;
      }
      list.innerHTML = decisions.map((d, i) => `
        <div class="decision-item ${i === currentDecisionIndex ? 'active' : ''}" onclick="selectDecision(${i})">
          <div class="decision-info">
            <strong>${d.name}</strong><br>
            <small>${d.factors.length} factor${d.factors.length === 1 ? '' : 's'}</small>
          </div>
          <button class="delete-decision-btn" onclick="event.stopPropagation(); deleteDecision(${i})">Delete</button>
        </div>
      `).join('');
    }

    function renderCurrentDecision() {
      if (currentDecisionIndex < 0) return;
      const decision = decisions[currentDecisionIndex];
      document.getElementById('decisionName').value = decision.name;
      renderFactors();
      updateFactorCount();
      hideResult();
    }

    function setDirection(dir) {
      currentDirection = dir;
      document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`.toggle-btn.${dir}`).classList.add('active');
    }

    function updateSlider() {
      document.getElementById('sliderValue').textContent = document.getElementById('likelihood').value;
    }

    function addFactor() {
      if (currentDecisionIndex < 0) return;
      const name = document.getElementById('factorName').value.trim();
      const strength = parseFloat(document.getElementById('likelihood').value);
      const weightStr = document.getElementById('weight').value;
      const weight = weightStr ? parseFloat(weightStr) : 1.0;

      if (!name) {
        alert("Please enter a factor name.");
        return;
      }
      if (isNaN(weight) || weight < 0) {
        alert("Weight must be a positive number.");
        return;
      }

      decisions[currentDecisionIndex].factors.push({
        name, strength, weight, direction: currentDirection
      });
      saveData();
      renderFactors();
      updateFactorCount();
      clearAddForm();
    }

    function clearAddForm() {
      document.getElementById('factorName').value = '';
      document.getElementById('likelihood').value = 50;
      document.getElementById('weight').value = '';
      updateSlider();
      setDirection('for');
    }

    function deleteFactor(index) {
      decisions[currentDecisionIndex].factors.splice(index, 1);
      saveData();
      renderFactors();
      updateFactorCount();
      hideResult();
    }

    function updateFactorCount() {
      document.getElementById('factorCount').textContent = decisions[currentDecisionIndex]?.factors.length || 0;
    }

    function renderFactors() {
      const list = document.getElementById('factorsList');
      const factors = decisions[currentDecisionIndex]?.factors || [];
      if (factors.length === 0) {
        list.innerHTML = '<p class="empty-message">No factors yet. Add one above!</p>';
        return;
      }
      list.innerHTML = factors.map((f, i) => `
        <div class="factor">
          <strong>${f.name}</strong>
          <div style="margin:8px 0; font-size:14px;">
            ${f.direction === 'for' ? 'Supports' : 'Opposes'} • Strength: ${f.strength}% • Weight: ${f.weight.toFixed(1)}
          </div>
          <span class="tag ${f.direction}">${f.direction.toUpperCase()}</span>
          <button class="delete-btn" onclick="deleteFactor(${i})">Delete</button>
        </div>
      `).join('');
    }

    function toggleFactors() {
      const content = document.getElementById('factorsContent');
      const arrow = document.getElementById('arrow');
      factorsExpanded = !factorsExpanded;
      if (factorsExpanded) {
        content.classList.remove('collapsed');
        arrow.classList.add('down');
      } else {
        content.classList.add('collapsed');
        arrow.classList.remove('down');
      }
    }

    function calculateOdds() {
      if (currentDecisionIndex < 0 || decisions[currentDecisionIndex].factors.length === 0) {
        alert("Add at least one factor first!");
        return;
      }

      let adjustment = 0;
      decisions[currentDecisionIndex].factors.forEach(f => {
        const impact = (f.strength / 100) * f.weight;
        adjustment += f.direction === 'for' ? impact : -impact;
      });

      let overall = 50 + adjustment * 50;
      overall = Math.max(0, Math.min(100, overall));

      const name = document.getElementById('decisionName').value.trim() || decisions[currentDecisionIndex].name;
      decisions[currentDecisionIndex].name = name;
      saveData();
      renderDecisionsList();

      document.getElementById('decisionTitle').textContent = name;
      const oddsEl = document.getElementById('overallOdds');
      oddsEl.textContent = overall.toFixed(1) + '%';
      oddsEl.className = 'odds';
      if (overall >= 70) oddsEl.classList.add('high');
      else if (overall >= 40) oddsEl.classList.add('medium');
      else oddsEl.classList.add('low');

      document.getElementById('resultCard').style.display = 'block';
    }

    function hideResult() {
      document.getElementById('resultCard').style.display = 'none';
    }

    document.getElementById('decisionName').addEventListener('change', () => {
      if (currentDecisionIndex >= 0) {
        decisions[currentDecisionIndex].name = document.getElementById('decisionName').value.trim() || "Untitled Decision";
        saveData();
        renderDecisionsList();
      }
    });

    loadData();
    updateSlider();
  </script>
</body>
</html>
